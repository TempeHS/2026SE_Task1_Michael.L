{% extends 'layout.html' %}
{% block content %}
<div class="container mt-4">
  <h1>Team Data Logs</h1>
  <br/>
  <div class="row mb-4">
    <div class="col-md-6">
      <form action="{{ url_for('datalogs') }}" method="GET" class="d-flex align-items-center flex-nowrap">
        <label for="developerFilter" class="me-2 text-nowrap">Filter by Developer:</label>
        <select name="developer" id="developerFilter" class="form-select me-2" onchange="this.form.submit()">
          <option value="">All Developers</option>
          {% for dev in developers %}
          <option value="{{ dev }}" {% if current_filter == dev %}selected{% endif %}>
            {{ dev }}
          </option>
          {% endfor %}
        </select>
        <button type="submit" class="btn btn-secondary">Filter</button>
        {% if current_filter %}
        <a href="{{ url_for('datalogs') }}" class="btn btn-outline-secondary ms-2">Clear Filter</a>
        {% endif %}
      </form>
    </div>
  </div>
  {% if logs %}
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Developer</th>
          <th>Project</th>
          <th>Repository</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Time Worked</th>
          <th>Notes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>
            <a href="{{ url_for('datalogs', developer=log.developer) }}" class="text-decoration-none">
              {{ log.developer }}
            </a>
          </td>
          <td>{{ log.project }}</td>
          <td>
            {% if log.repo %}
            <a href="{{ log.repo }}" target="_blank" rel="noopener noreferrer">View Repo</a>
            {% else %}
            -
            {% endif %}
          </td>
          <td>{{ log.start_time | datetimeformat }}</td>
          <td>{{ log.end_time | datetimeformat }}</td>
          <td><strong>{{ log.time_worked }}</strong></td>
          <td>{{ log.developer_notes[:50] }}{% if log.developer_notes|length > 50 %}...{% endif %}</td>
          <td>
            <a href="{{ url_for('logdetails', log_id=log.id) }}" class="btn btn-sm btn-info">View Details</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <p class="text-muted">
    Showing {{ logs|length }} log(s)
    {% if current_filter %}
    for developer: <strong>{{ current_filter }}</strong>
    {% endif %}
  </p>
  {% else %}
  <div class="alert alert-info">
    No logs found.
    {% if current_filter %}
    for developer <strong>{{ current_filter }}</strong>
    {% endif %}
    Add your first log entry!
  </div>
  {% endif %}

  <form action="{{ url_for('datalogs') }}" method="POST" class="mt-4">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <div class="d-grid gap-2">
      <button class="btn btn-primary" type="submit">Add Log</button>
    </div>
  </form>
</div>
{% endblock %}