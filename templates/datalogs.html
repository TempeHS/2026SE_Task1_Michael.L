{% extends 'layout.html' %}
{% block content %}
<div class="container mt-4">
  <h1>Team Data Logs</h1>
  <br/>
  <div class="row mb-4">
    <div class="col-md-12">
      <form action="{{ url_for('datalogs') }}" method="GET" class="row g-3 align-items-end">
        <div class="col-md-3">
          <label for="searchContent" class="form-label">Search Content:</label>
          <input type="text" name="search" id="searchContent" class="form-control" value="{{ search or '' }}" placeholder="Search logs...">
        </div>
        <div class="col-md-2">
          <label for="developerFilter" class="form-label">Filter by Developer:</label>
          <select name="developer" id="developerFilter" class="form-select">
            <option value="">All Developers</option>
            {% for dev in developers %}
            <option value="{{ dev }}" {% if current_filter == dev %}selected{% endif %}>
              {{ dev }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label for="projectFilter" class="form-label">Filter by Project:</label>
          <select name="project" id="projectFilter" class="form-select">
            <option value="">All Projects</option>
            {% for proj in projects %}
            <option value="{{ proj }}" {% if project == proj %}selected{% endif %}>
              {{ proj }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label for="startDate" class="form-label">Start Date:</label>
          <input type="date" name="start_date" id="startDate" class="form-control" value="{{ start_date or '' }}">
        </div>
        <div class="col-md-2">
          <label for="endDate" class="form-label">End Date:</label>
          <input type="date" name="end_date" id="endDate" class="form-control" value="{{ end_date or '' }}">
        </div>
        <div class="col-md-1">
          <button type="submit" class="btn btn-success w-100">Filter</button>
          {% if current_filter or start_date or end_date or project %}
          <a href="{{ url_for('datalogs') }}" class="btn btn-outline-secondary w-100 mt-2">Clear</a>
          {% endif %}
        </div>
      </form>
    </div>
  </div>
  {% if logs %}
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Developer</th>
          <th>Project</th>
          <th>Repository</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Time Worked</th>
          <th>Log Entry Time</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for log in logs %}
        <tr>
          <td>
            <a href="{{ url_for('datalogs', developer=log.developer) }}" class="text-decoration-none">
              {{ log.developer }}
            </a>
          </td>
          <td>{{ log.project }}</td>
          <td>
            {% if log.repo %}
            <a href="{{ log.repo }}" target="_blank" rel="noopener noreferrer">View Repo</a>
            {% else %}
            -
            {% endif %}
          </td>
          <td>{{ log.start_time | datetimeformat }}</td>
          <td>{{ log.end_time | datetimeformat }}</td>
          <td><strong>{{ log.time_worked }}</strong></td>
          <td>{{ log.log_entry_time | datetimeformat }}</td>
          <td>
            <a href="{{ url_for('logdetails', log_id=log.id) }}" class="btn btn-sm btn-info">View Details</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <p class="text-muted">
    Showing {{ logs|length }} log(s)
    {% if current_filter or start_date or end_date or project or search %}
    with filters: 
    {% if search %}<strong>Search: "{{ search }}"</strong>{% endif %}
    {% if current_filter %}<strong>Developer: {{ current_filter }}</strong>{% endif %}
    {% if project %}<strong>Project: {{ project }}</strong>{% endif %}
    {% if start_date %}<strong>From: {{ start_date }}</strong>{% endif %}
    {% if end_date %}<strong>To: {{ end_date }}</strong>{% endif %}
    {% endif %}
  </p>
  {% else %}
  <div class="alert alert-info">
    No logs found with the current filters.
  </div>
  {% endif %}

  <form action="{{ url_for('datalogs') }}" method="POST" class="mt-4">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <div class="d-grid gap-2">
      <button class="btn btn-primary" type="submit">Add Log</button>
    </div>
  </form>
</div>
{% endblock %}